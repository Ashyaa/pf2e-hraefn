{"name":"Wild Fire Surge","type":"script","scope":"global","author":"xOdDnnmVO5ECXCHC","img":"icons/magic/fire/elemental-fire-humanoid.webp","command":"let toChat = (content) => {\n    let chatData = {\n        user: game.user.id,\n        content,\n        speaker: ChatMessage.getSpeaker(),\n    };\n    ChatMessage.create(chatData, {});\n}\n\nlet r = new Roll(\"1d50\");\nawait r.roll({ async: true });\n\nnew Dialog({\n    title: 'Current surge counter',\n    content: `\n    <form>\n      <div class=\"form-group\">\n        <label>Value</label>\n        <input type='number' name='inputField'></input>\n      </div>\n    </form>`,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Execute`\n        }\n    },\n    default: 'yes',\n    close: html => {\n        let result = html.find('input[name=\\'inputField\\']');\n        if (result.val() !== '') {\n            let counter = Number(result.val());\n            let failure = false;\n            let flavor = `\n                <strong>Wild Fire Surge</strong></br>\n                Target: Self (DC ${counter})</br>\n                Result: `;\n            if (r.result <= counter) {\n                flavor += `<a style=\"color: rgb(247, 59, 59);\">Failure</a> by ${r.result - counter}`;\n                failure = true;\n            } else {\n                flavor += `<a style=\"color: #91a82a;\">Success</a> by +${r.result - counter}`;\n            }\n            flavor += `</br><hr>\n                <section class=\"roll-note\">\n                <p><strong>Success</strong> The creature's surge counter increases to ${counter + 1}.</br></p>\n                <p><strong>Failure</strong> The creature's surge counter resets to 0, and the creature rolls a wildfire effect.</br></p>\n                </section>`\n            r.toMessage({\n                user: game.user.id,\n                flavor: flavor,\n                speaker: ChatMessage.getSpeaker(),\n            });\n            if (failure) {\n                let table = game.tables.find(t => t.name === \"Wild Fire Surge\");\n                if (table === undefined) {\n                    console.log(\"table not found\");\n                } else {\n                    table.draw();\n                }\n            }\n        }\n    }\n}).render(true);","flags":{"advanced-macros":{"runAsGM":false,"runForSpecificUser":""},"core":{"sourceId":"Macro.edGvKJPIDzqbzWJw"}},"_stats":{"systemId":"pf2e","systemVersion":"4.11.2","coreVersion":"10.291","createdTime":1683828603049,"modifiedTime":1683828773356,"lastModifiedBy":"xOdDnnmVO5ECXCHC"},"folder":null,"sort":0,"ownership":{"default":0,"xOdDnnmVO5ECXCHC":3},"_id":"APiKkPq0fhjVzcUs"}
{"$$deleted":true,"_id":"APiKkPq0fhjVzcUs"}
{"name":"Wild Fire Surge","type":"script","scope":"global","author":"xOdDnnmVO5ECXCHC","img":"icons/magic/fire/elemental-fire-humanoid.webp","command":"let toChat = (content) => {\n    let chatData = {\n        user: game.user.id,\n        content,\n        speaker: ChatMessage.getSpeaker(),\n    };\n    ChatMessage.create(chatData, {});\n}\n\nlet r = new Roll(\"1d50\");\nawait r.roll({ async: true });\n\nnew Dialog({\n    title: 'Current surge counter',\n    content: `\n    <form>\n      <div class=\"form-group\">\n        <label>Value</label>\n        <input type='number' name='inputField'></input>\n      </div>\n    </form>`,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Execute`\n        }\n    },\n    default: 'yes',\n    close: html => {\n        let result = html.find('input[name=\\'inputField\\']');\n        if (result.val() !== '') {\n            let counter = Number(result.val());\n            let failure = false;\n            let flavor = `\n                <strong>Wild Fire Surge</strong></br>\n                Target: Self (DC ${counter})</br>\n                Result: `;\n            if (r.result <= counter) {\n                flavor += `<a style=\"color: rgb(247, 59, 59);\">Failure</a> by ${r.result - counter}`;\n                failure = true;\n            } else {\n                flavor += `<a style=\"color: #91a82a;\">Success</a> by +${r.result - counter}`;\n            }\n            flavor += `</br><hr>\n                <section class=\"roll-note\">\n                <p><strong>Success</strong> The creature's surge counter increases to ${counter + 1}.</br></p>\n                <p><strong>Failure</strong> The creature's surge counter resets to 0, and the creature rolls a wildfire effect.</br></p>\n                </section>`\n            r.toMessage({\n                user: game.user.id,\n                flavor: flavor,\n                speaker: ChatMessage.getSpeaker(),\n            });\n            if (failure) {\n                const rollTablePack = game.packs.get(\"pf2e-hraefn.hraefn-rollable-tables\");\n                rollTablePack.getIndex();\n                rollTableID = rollTablePack.index.find(t => t.name === 'Wild Fire Surge')._id;\n                rollTablePack.getDocument(rollTableID).then(table => table.draw());\n                // let table = game.tables.find(t => t.name === \"Wild Fire Surge\");\n                // if (table === undefined) {\n                //     console.log(\"table not found\");\n                // } else {\n                //     table.draw();\n                // }\n            }\n        }\n    }\n}).render(true);","flags":{"advanced-macros":{"runAsGM":false,"runForSpecificUser":""},"core":{"sourceId":"Macro.edGvKJPIDzqbzWJw"}},"_stats":{"systemId":"pf2e","systemVersion":"4.11.2","coreVersion":"10.291","createdTime":1683828603049,"modifiedTime":1683833811119,"lastModifiedBy":"xOdDnnmVO5ECXCHC"},"ownership":{"default":0,"xOdDnnmVO5ECXCHC":3},"folder":null,"sort":0,"_id":"Ow0Ml0cV95UjP5Mm"}
